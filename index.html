<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Directional Arrow</title>
    <style>
        /* Styling for the container and arrow */
        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 200px;
            height: 200px;
            background-color: green;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            margin-top: 20vh;
        }

        .arrow {
            width: 50%;
            height: 50%;
            background: url("https://p9n2c8y2.rocketcdn.me/wp-content/uploads/2021/05/24.png.webp") center no-repeat;
            background-size: contain;
            transform: translate(-50%, -50%) rotate(0deg);
            transition: transform 0.3s ease;
            position: absolute;
            top: 50%;
            left: 50%;
        }
    </style>
</head>
<body onload="startTracking()">

    <div class="container">
        <div class="arrow" id="arrow"></div>
        <h1>Compass</h1>
    </div>
    <div id="info" style="text-align:center; margin-top: 20px; font-family: Arial, sans-serif;"></div>

    <script>
        // Target location coordinates
        const destinationLatitude = 1.30864;
        const destinationLongitude = 103.84955;
        let compassHeading = 0;

        function startTracking() {
            // Start watching location and device orientation
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(updateArrowDirection, showError, {
                    enableHighAccuracy: true,
                    maximumAge: 0,
                    timeout: 5000
                });
                
                window.addEventListener("deviceorientationabsolute", updateCompassHeading, true);
            } else {
                document.getElementById("info").innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        // Update the compass heading from device orientation
        function updateCompassHeading(event) {
            // event.alpha gives us the compass heading in degrees
            compassHeading = event.alpha || 0;
        }

        // Update the arrow direction based on player's location and orientation
        function updateArrowDirection(location) {
            const phoneLatitude = location.coords.latitude;
            const phoneLongitude = location.coords.longitude;

            // Calculate bearing from the player to the destination
            const bearingToDestination = calculateBearing(phoneLatitude, phoneLongitude, destinationLatitude, destinationLongitude);

            // Adjust the arrow direction by combining bearing and compass heading
            const adjustedBearing = (bearingToDestination - compassHeading + 360) % 360;

            // Rotate the arrow to point towards the target
            const arrow = document.getElementById('arrow');
            arrow.style.transform = `translate(-50%, -50%) rotate(${adjustedBearing}deg)`;

            // Update info display
            document.getElementById("info").innerHTML = `
                Longitude: ${phoneLongitude.toFixed(5)}<br>
                Latitude: ${phoneLatitude.toFixed(5)}<br>
                Compass Heading: ${compassHeading.toFixed(0)}°<br>
                Bearing to Target: ${bearingToDestination.toFixed(0)}°<br>
                Arrow Angle: ${adjustedBearing.toFixed(0)}°
            `;
        }

        function calculateBearing(lat1, lng1, lat2, lng2) {
            const dLon = toRad(lng2 - lng1);
            lat1 = toRad(lat1);
            lat2 = toRad(lat2);

            const y = Math.sin(dLon) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);
            const rad = Math.atan2(y, x);
            const brng = toDeg(rad);
            return (brng + 360) % 360;
        }

        function toRad(deg) {
            return deg * Math.PI / 180;
        }

        function toDeg(rad) {
            return rad * 180 / Math.PI;
        }

        function showError(error) {
            const info = document.getElementById("info");
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    info.innerHTML = "User denied the request for Geolocation.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    info.innerHTML = "Location information is unavailable.";
                    break;
                case error.TIMEOUT:
                    info.innerHTML = "The request to get user location timed out.";
                    break;
                default:
                    info.innerHTML = "An unknown error occurred.";
                    break;
            }
        }
    </script>
</body>
</html>
